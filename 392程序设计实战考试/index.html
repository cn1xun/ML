<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>æ‹›è˜æ•°æ®åˆ†æå·¥å…·</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 40px auto;
      padding: 20px;
      background-color: #f9f9f9;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .card {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    button {
      margin-top: 10px;
      padding: 8px 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    input[type="file"] {
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <h1>ğŸ“Š æ‹›è˜æ•°æ®åˆ†æå·¥å…·</h1>

  <!-- ä»»åŠ¡1ï¼šè–ªèµ„åˆ†æ -->
  <div class="card">
    <h2>1. æŒ‰åœ°åŒºç»Ÿè®¡è–ªèµ„</h2>
    <p>ä¸Šä¼ åŒ…å« <code>district</code> å’Œ <code>salary</code> åˆ—çš„ CSV æ–‡ä»¶</p>
    <input type="file" id="salaryFile" accept=".csv" />
    <br />
    <button onclick="uploadSalary()">å¼€å§‹åˆ†æå¹¶ä¸‹è½½ Excel</button>
  </div>

  <!-- ä»»åŠ¡2ï¼šå…¬å¸æ•°é‡æŸ±çŠ¶å›¾ -->
  <div class="card">
    <h2>2. æŒ‰åœ°åŒºç»Ÿè®¡å…¬å¸æ•°é‡</h2>
    <p>ä¸Šä¼ åŒ…å« <code>district</code> å’Œ <code>company</code> åˆ—çš„ CSV æ–‡ä»¶</p>
    <input type="file" id="companyFile" accept=".csv" />
    <br />
    <button onclick="uploadCompanyChart()">ç”ŸæˆæŸ±çŠ¶å›¾å¹¶ä¸‹è½½ PNG</button>
  </div>

  <script>
    // ä»»åŠ¡1ï¼šä¸Šä¼ è–ªèµ„æ•°æ®
    async function uploadSalary() {
      const fileInput = document.getElementById('salaryFile');
      const file = fileInput.files[0];
      if (!file) {
        alert("è¯·å…ˆé€‰æ‹©ä¸€ä¸ª CSV æ–‡ä»¶ï¼");
        return;
      }

      const formData = new FormData();
      formData.append("file", file);

      try {
        const response = await fetch("http://127.0.0.1:8000/analyze/salary_by_district", {
          method: "POST",
          body: formData
        });

        if (response.ok) {
          // è§¦å‘æ–‡ä»¶ä¸‹è½½
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = "è–ªèµ„ç»Ÿè®¡.xlsx";
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
          document.body.removeChild(a);
        } else {
          alert("åˆ†æå¤±è´¥ï¼Œè¯·æ£€æŸ¥ CSV æ ¼å¼ï¼");
        }
      } catch (err) {
        console.error(err);
        alert("è¯·æ±‚å‡ºé”™ï¼š" + err.message);
      }
    }

    // ä»»åŠ¡2ï¼šä¸Šä¼ å…¬å¸æ•°æ®
    async function uploadCompanyChart() {
      const fileInput = document.getElementById('companyFile');
      const file = fileInput.files[0];
      if (!file) {
        alert("è¯·å…ˆé€‰æ‹©ä¸€ä¸ª CSV æ–‡ä»¶ï¼");
        return;
      }

      const formData = new FormData();
      formData.append("file", file);

      try {
        const response = await fetch("http://127.0.0.1:8000/analyze/company_count_chart", {
          method: "POST",
          body: formData
        });

        if (response.ok) {
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = "å…¬å¸æ•°é‡æŸ±çŠ¶å›¾.png";
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
          document.body.removeChild(a);
        } else {
          alert("ç»˜å›¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥ CSV æ ¼å¼ï¼");
        }
      } catch (err) {
        console.error(err);
        alert("è¯·æ±‚å‡ºé”™ï¼š" + err.message);
      }
    }
  </script>

</body>
</html>